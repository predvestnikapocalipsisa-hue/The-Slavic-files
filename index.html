<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Messages search</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    padding: 20px;
}
input {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    margin-bottom: 15px;
}
li {
    margin: 6px 0;
}
a {
    color: #6cf;
    text-decoration: none;
}
small {
    color: #aaa;
}
</style>
</head>
<body>

<h1>Поиск по messages (1–150)</h1>

<input id="query" placeholder="Введите текст для поиска...">

<ul id="results"></ul>

<script>
const results = document.getElementById("results");
const queryInput = document.getElementById("query");

const files = ["messages.html"];
for (let i = 2; i <= 150; i++) {
    files.push(`messages${i}.html`);
}

async function search(text) {
    results.innerHTML = "Ищу...";
    const found = [];

    for (const file of files) {
        try {
            const res = await fetch(file);
            const html = await res.text();

            if (html.toLowerCase().includes(text.toLowerCase())) {
                found.push(file);
            }
        } catch (e) {
            console.warn("Не удалось загрузить", file);
        }
    }

    results.innerHTML = "";

    if (found.length === 0) {
        results.innerHTML = "<li>Ничего не найдено</li>";
        return;
    }

    for (const file of found) {
        const li = document.createElement("li");
        li.innerHTML = `<a href="${file}">${file}</a> <small>— найдено</small>`;
        results.appendChild(li);
    }
}

let timeout;
queryInput.addEventListener("input", () => {
    clearTimeout(timeout);
    const text = queryInput.value.trim();
    if (text.length < 2) {
        results.innerHTML = "";
        return;
    }
    timeout = setTimeout(() => search(text), 400);
});
</script>

</body>
</html>
